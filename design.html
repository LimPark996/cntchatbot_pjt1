<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>부동산 리포트 챗봇 UI (프로토타입)</title>
  <style>
    :root{
      --teal:#039aa0;
      --teal-dark:#01767a;
      --bg:#f2f2f0;
      --panel:#e6e6e0;
      --white:#ffffff;
      --muted:#9aa0a0;
      --card-radius:12px;
      font-family: "Noto Sans KR", "Arial", sans-serif;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#e9f6f7 0%, #f2f6f6 100%);}
    .app{
      display:grid;
      grid-template-columns:300px 1fr 340px;
      gap:18px;
      height:100vh;
      padding:20px;
      box-sizing:border-box;
    }

    /* LEFT SIDEBAR */
    .sidebar{
      background:var(--teal);
      color:var(--white);
      border-radius:12px;
      padding:18px;
      box-shadow:0 6px 18px rgba(3,154,160,0.12);
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
    }
    .brand .logo{
      width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#00c2c6,#01767a);display:flex;align-items:center;justify-content:center;font-weight:700;
      box-shadow:0 3px 8px rgba(0,0,0,0.12);
    }
    .brand h1{font-size:16px;margin:0}
    .faq-list{background:rgba(255,255,255,0.06);border-radius:10px;padding:10px;flex:1;overflow:auto}
    .faq-item{background:rgba(255,255,255,0.06);padding:12px;border-radius:8px;margin-bottom:10px;cursor:pointer;}
    .faq-item:hover{background:rgba(255,255,255,0.12)}
    .controls{background:rgba(255,255,255,0.04);padding:12px;border-radius:10px}
    .control-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:8px}
    .control-row label{font-size:13px;opacity:0.95}
    .control-row input[type=range]{width:100%}
    .small{font-size:12px;color:rgba(255,255,255,0.85);opacity:0.95}

    /* CENTER CHAT */
    .chat-panel{
      background:var(--panel);
      border-radius:12px;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }
    .chat-top{display:flex;align-items:center;gap:12px}
    .bot-card{background:linear-gradient(90deg,#f8fbfb,#eef2f1);padding:12px;border-radius:10px;flex:1;color:#1b2b2b}
    .chat-area{flex:1;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:12px}
    .message{display:flex;gap:12px;align-items:flex-start}
    .msg-bubble{max-width:72%;padding:12px;border-radius:12px;line-height:1.45}
    .from-bot .msg-bubble{background:var(--white);border:1px solid #e8e8e6;border-top-left-radius:4px}
    .from-user{justify-content:flex-end}
    .from-user .msg-bubble{background:linear-gradient(90deg,#7be0df,#1fbfc0);color:white;border-radius:12px 12px 12px 4px}
    .avatar{width:48px;height:48px;border-radius:10px;flex-shrink:0;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .avatar svg{width:40px;height:40px}

    .meta-row{display:flex;gap:8px;align-items:center;font-size:12px;color:var(--muted)}
    .sources{margin-top:8px;background:#fbfbfb;border-radius:8px;padding:10px;border:1px solid #eee;display:none}
    .source-toggle{background:transparent;border:0;color:var(--teal-dark);cursor:pointer;font-weight:600;margin-left:6px}

    /* BOTTOM INPUT */
    .chat-input{display:flex;gap:8px;align-items:center}
    .text-input{flex:1;padding:12px;border-radius:10px;border:1px solid #ddd;background:white;min-height:48px;resize:none}
    .send-btn{background:linear-gradient(90deg,#17b2b6,#0aa6a9);color:white;border:0;padding:12px 16px;border-radius:10px;cursor:pointer}
    .send-btn:active{transform:translateY(1px)}

    /* RIGHT PANEL (sources preview) */
    .right-panel{
      background:linear-gradient(180deg,#00b7bb,#01767a);
      color:white;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:12px;
      box-shadow:0 6px 18px rgba(1,120,122,0.12)
    }
    .right-card{background:rgba(255,255,255,0.07);padding:12px;border-radius:10px}
    .right-card h3{margin:0 0 8px 0}
    .source-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    .source-list li{background:rgba(255,255,255,0.04);padding:10px;border-radius:8px;font-size:13px}

    /* responsive */
    @media (max-width:1100px){
      .app{grid-template-columns:260px 1fr;grid-auto-rows:1fr}
      .right-panel{display:none}
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- LEFT SIDEBAR -->
    <aside class="sidebar" aria-label="왼쪽 사이드바">
      <div class="brand">
        <div class="logo">RE</div>
        <div>
          <h1>부동산 시장 동향 리포트 Q&A</h1>
          <div class="small">리포트 기반 인사이트 챗봇</div>
        </div>
      </div>

      <div class="small">자주 묻는 질문</div>
      <div class="faq-list" id="faqList">
        <div class="faq-item" data-text="서울 강남구 아파트 매매 최근 3개월 가격 추이 보여줘">서울 강남구 아파트 매매 최근 3개월 가격 추이</div>
        <div class="faq-item" data-text="2024년 지역별 전세가 변동률을 표로 보여줘">2024년 지역별 전세가 변동률</div>
        <div class="faq-item" data-text="강남구 소형 평형(전용 59m²) 최근 거래 사례 요약">강남구 소형 평형 거래 사례</div>
        <div class="faq-item" data-text="서울 아파트 평균 매매가와 작년 대비 증감률">서울 아파트 평균 매매가</div>
      </div>

      <div class="controls">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="small">검색 민감도 (Temperature)</div>
          <div class="small" id="tempVal">0.7</div>
        </div>
        <div class="control-row">
          <input id="temp" type="range" min="0" max="1" step="0.05" value="0.7">
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="small">참고할 페이지 수 (Top-k)</div>
          <div class="small" id="topkVal">5</div>
        </div>
        <div class="control-row">
          <input id="topk" type="range" min="1" max="20" step="1" value="5">
        </div>

        <div style="margin-top:8px;font-size:13px;color:rgba(255,255,255,0.9)">
          설정값은 백엔드 호출 시 파라미터로 전달됩니다. (현재는 UI 프로토타입)
        </div>
      </div>

      <div style="font-size:12px;opacity:0.9">디자인: 리포트 Q&A 예시</div>
    </aside>

    <!-- CENTER CHAT PANEL -->
    <main class="chat-panel" role="main">
      <div class="chat-top">
        <div class="avatar" aria-hidden="true">
          <!-- 챗봇 프로필 캐릭터 (간단한 SVG) -->
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#17b2b6"/>
                <stop offset="1" stop-color="#01767a"/>
              </linearGradient>
            </defs>
            <rect rx="14" width="100" height="100" fill="url(#g1)"/>
            <g transform="translate(16,18)" fill="#fff">
              <circle cx="20" cy="22" r="12" opacity="0.95"/>
              <rect x="8" y="46" width="52" height="28" rx="6" opacity="0.12" fill="#ffffff"/>
              <rect x="16" y="36" width="36" height="10" rx="5" opacity="0.18"/>
            </g>
          </svg>
        </div>
        <div class="bot-card">
          <div style="font-weight:700">안녕하세요 — 리포트 기반 Q&A입니다.</div>
          <div style="font-size:13px;color:#475d5d;margin-top:6px">
            질문을 입력하면 표/그래프로 시각화 가능한 결과와 함께 제공합니다. (예: "2024년 지역별 주택 가격 변동률 표로 보여줘")
          </div>
        </div>
      </div>

      <div class="chat-area" id="chatArea" aria-live="polite">
        <!-- Initial Bot Message -->
        <div class="message from-bot">
          <div class="avatar" aria-hidden="true">
            <!-- 작은 bot avatar -->
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <rect rx="12" width="100" height="100" fill="#fff"/>
              <circle cx="50" cy="40" r="18" fill="#01767a" />
            </svg>
          </div>
          <div>
            <div class="msg-bubble">
              안녕하세요! 부동산 인사이트봇입니다. 지역(예: 서울 강남구), 거래종류(매매/전세), 기간(예: 최근 3개월)을 입력하시면 최신 동향 요약을 제공해드립니다.
              <div class="meta-row">
                <span class="small">예시 사용자 입력:</span>
                <span style="font-weight:600;margin-left:6px">"서울 강남구 아파트 매매 최근 3개월 가격 추이 보여줘"</span>
              </div>
            </div>

            <div class="sources" id="initSources">
              <strong>근거 자료 및 데이터</strong>
              <div style="margin-top:6px;font-size:13px;color:#333">
                예: [보고서 A] 표 1-2 (12페이지), [보고서 B] 본문 (25페이지)
              </div>
            </div>
          </div>
        </div>

        <!-- Example user reply -->
        <div class="message from-user" style="align-self:flex-end;">
          <div>
            <div class="msg-bubble">최근 3개월간 서울 강남구 아파트 매매 가격 변동 요약 부탁해</div>
          </div>
        </div>

      </div>

      <!-- INPUT -->
      <div>
        <div class="chat-input">
          <textarea id="userInput" class="text-input" placeholder='질문을 입력하세요. 예) 2024년 지역별 주택 가격 변동률 표로 보여줘'>서울 강남구 아파트 매매 최근 3개월 가격 추이 보여줘</textarea>
          <button id="sendBtn" class="send-btn" title="전송">전송</button>
        </div>
      </div>
    </main>

    <!-- RIGHT PANEL (출처/요약 카드) -->
    <aside class="right-panel" aria-label="오른쪽 정보">
      <div class="right-card">
        <h3>시각화 미리보기</h3>
        <div class="small">차트 / 표가 렌더됩니다 (프로토타입)</div>
        <div style="height:120px;background:rgba(255,255,255,0.03);border-radius:8px;margin-top:8px;display:flex;align-items:center;justify-content:center">
          미리보기 영역
        </div>
      </div>

      <div class="right-card">
        <h3>출처 / 컨텍스트</h3>
        <ul class="source-list" id="sourceList">
          <li>[1] 보고서 A — 표 1-2 (12페이지)</li>
          <li>[2] 보고서 B — 본문 (25페이지)</li>
        </ul>
      </div>

      <div class="right-card">
        <h3>설명</h3>
        <div class="small">봇 응답에 "근거 자료 및 데이터" 토글을 포함하여 출처를 쉽게 확인할 수 있습니다.</div>
      </div>
    </aside>

  </div>

  <script>
    // 기본 DOM 참조
    const faqList = document.getElementById('faqList');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatArea = document.getElementById('chatArea');
    const temp = document.getElementById('temp');
    const topk = document.getElementById('topk');
    const tempVal = document.getElementById('tempVal');
    const topkVal = document.getElementById('topkVal');
    const sourceList = document.getElementById('sourceList');

    // FAQ 클릭 -> 입력창 채우기
    faqList.addEventListener('click', e => {
      const item = e.target.closest('.faq-item');
      if(!item) return;
      const txt = item.getAttribute('data-text') || item.innerText;
      userInput.value = txt;
      userInput.focus();
    });

    // 슬라이더 표시 업데이트
    temp.addEventListener('input', () => tempVal.textContent = temp.value);
    topk.addEventListener('input', () => topkVal.textContent = topk.value);

    // 메시지 생성 함수
    function appendMessage({from='bot', text='', sources=[]}){
      const wrapper = document.createElement('div');
      wrapper.className = 'message ' + (from === 'bot' ? 'from-bot' : 'from-user');
      // avatar
      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.innerHTML = from === 'bot' ? `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <rect rx="12" width="100" height="100" fill="#fff"/>
          <circle cx="50" cy="40" r="18" fill="#01767a" />
        </svg>
      ` : `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <rect rx="12" width="100" height="100" fill="#fff"/>
          <circle cx="50" cy="50" r="18" fill="#7be0df" />
        </svg>
      `;

      const content = document.createElement('div');

      const bubble = document.createElement('div');
      bubble.className = 'msg-bubble';
      bubble.innerHTML = text.replace(/\n/g,'<br/>');

      content.appendChild(bubble);

      if(from === 'bot' && sources && sources.length>0){
        const meta = document.createElement('div');
        meta.className = 'meta-row';
        meta.innerHTML = `<button class="source-toggle" aria-expanded="false">근거 자료 및 데이터 ▾</button>`;
        content.appendChild(meta);

        const sourcesBox = document.createElement('div');
        sourcesBox.className = 'sources';
        let html = '<strong>근거 자료 및 데이터</strong>';
        html += '<ul style="margin-top:8px;padding-left:18px">';
        sources.forEach(s => {
          html += `<li style="margin-bottom:6px">${s}</li>`;
        });
        html += '</ul>';
        sourcesBox.innerHTML = html;
        content.appendChild(sourcesBox);

        // 토글 이벤트
        meta.querySelector('.source-toggle').addEventListener('click', (ev) => {
          const btn = ev.currentTarget;
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          sourcesBox.style.display = expanded ? 'none' : 'block';
          btn.textContent = expanded ? '근거 자료 및 데이터 ▾' : '근거 자료 및 데이터 ▴';
        });
      }

      if(from === 'bot'){
        wrapper.appendChild(avatar);
        wrapper.appendChild(content);
      } else {
        // 사용자 메시지는 오른쪽 정렬
        wrapper.style.justifyContent = 'flex-end';
        content.style.display = 'flex';
        content.style.flexDirection = 'column';
        wrapper.appendChild(content);
        wrapper.appendChild(avatar);
      }

      chatArea.appendChild(wrapper);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    // 전송 버튼(프로토타입 동작)
    sendBtn.addEventListener('click', () => {
      const txt = userInput.value.trim();
      if(!txt) return;
      appendMessage({from:'user', text: txt});
      userInput.value = '';

      // UI에서 설정된 파라미터(나중에 백엔드로 전달)
      const params = {
        temperature: parseFloat(temp.value),
        topk: parseInt(topk.value,10)
      };

      // 프로토타입: 로딩 메시지 후에 더미 응답 생성
      setTimeout(() => {
        // 예시 응답 텍스트 (실제 호출 시 LLM결과로 대체)
        const answerText = `
요약: 최근 3개월간 서울 강남구 아파트 매매가는 전반적으로 완만한 상승세를 보였습니다.
- 평균 상승률: 약 1.8% (분기 기준)
- 주요 원인: 수요 회복, 고급 주택 선호 지속
(설명 및 표/차트는 시각화 탭에 렌더됩니다)
        `;
        const dummySources = [
          '[보고서 A] 서울 부동산 리포트 2025 - 표 3.1 (p.12)',
          '[보고서 B] 거래 데이터 요약 (국토교통부 실거래가)',
          '[논문 C] 지역별 가격 동향 분석 (2024)'
        ];
        appendMessage({from:'bot', text: answerText, sources: dummySources});

        // 오른쪽 출처 리스트도 업데이트 (예시)
        sourceList.innerHTML = dummySources.map((s,i)=>`<li>[${i+1}] ${s}</li>`).join('');
      }, 700);

    });

    // 엔터로 전송 (Shift+Enter 줄바꿈 허용)
    userInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendBtn.click();
      }
    });

    // 초기 소스 토글 보이기 (예제)
    document.getElementById('initSources').style.display = 'block';
  </script>
</body>
</html>
